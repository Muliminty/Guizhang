# 归藏 (Guizhang) - 产品需求文档

## 文档信息
| 项目 | 值 |
|------|----|
| **产品名称** | 归藏 (Guizhang) |
| **产品版本** | v1.0 (MVP) |
| **文档版本** | 1.0 |
| **创建日期** | 2026-02-16 |
| **最后更新** | 2026-02-16 |
| **产品负责人** | [待补充] |
| **技术负责人** | [待补充] |

## 1. 产品概述

### 1.1 产品愿景
打造一个**隐私安全、离线优先**的文章剪藏与知识管理工具，让用户能够轻松收藏、整理和检索网络文章，构建个人知识库。

### 1.2 核心价值
- **隐私保护**：数据完全本地存储，用户拥有完全控制权
- **离线可用**：无需网络即可使用，随时随地访问剪藏内容
- **简洁高效**：输入URL即完成剪藏，自动转换为易读的Markdown格式
- **多平台覆盖**：一套代码适配Web、PWA、iOS/Android App

### 1.3 目标用户
| 用户类型 | 使用场景 | 核心需求 |
|----------|----------|----------|
| **个人学习者** | 收藏技术文章、博客、教程 | 快速收藏、离线阅读、搜索检索 |
| **内容创作者** | 收集素材、竞品分析 | 分类整理、标签管理、内容提取 |
| **研究学者** | 收集学术资料、文献 | 全文搜索、笔记标注、数据导出 |
| **普通网民** | 收藏感兴趣的文章 | 简单易用、无需注册、跨设备同步 |

### 1.4 关键成功指标 (KSI)
- **用户获取**：上线3个月内获取1000名活跃用户
- **用户留存**：7日留存率 > 40%，30日留存率 > 25%
- **功能使用**：平均每用户剪藏文章 > 10篇
- **付费转化**：云同步功能付费转化率 > 5%

## 2. 功能需求

### 2.1 核心功能（MVP v1.0）

#### 2.1.1 文章剪藏
**需求描述**：用户输入文章URL，系统自动抓取网页内容，提取正文，转换为Markdown格式保存。

| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **URL输入** | P0 | 支持HTTP/HTTPS URL验证，提供即时反馈 |
| **网页抓取** | P0 | 支持静态网页抓取，处理常见网站结构 |
| **内容解析** | P0 | 使用Readability算法提取正文，去除广告导航等噪音 |
| **格式转换** | P0 | HTML转Markdown，保持基础格式（标题、列表、代码块） |
| **元数据提取** | P0 | 自动提取标题、作者、发布时间、阅读时长等 |
| **预览编辑** | P1 | 剪藏前预览内容，支持手动编辑标题和内容 |
| **批量导入** | P2 | 支持批量导入URL列表 |

#### 2.1.2 文章管理
**需求描述**：提供文章列表、详情查看、编辑、删除等管理功能。

| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **文章列表** | P0 | 支持分页、排序（时间、标题）、虚拟滚动 |
| **搜索功能** | P0 | 支持标题和内容全文搜索，实时显示结果 |
| **文章详情** | P0 | 完整显示文章内容和元数据，支持Markdown渲染 |
| **编辑功能** | P1 | 支持修改标题、内容、标签 |
| **删除功能** | P0 | 支持单条和批量删除，提供回收站机制 |
| **星标/归档** | P1 | 支持标记重要文章和归档不再关注的文章 |

#### 2.1.3 标签系统
**需求描述**：支持为文章添加标签，按标签分类管理。

| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **标签创建** | P0 | 支持创建、编辑、删除标签 |
| **标签分配** | P0 | 支持为文章分配多个标签 |
| **标签筛选** | P1 | 按标签筛选文章列表 |
| **标签统计** | P2 | 显示标签使用频率统计 |

#### 2.1.4 本地存储
**需求描述**：数据完全本地存储，支持离线访问。

| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **IndexedDB存储** | P0 | Web端使用IndexedDB存储文章和标签数据 |
| **SQLite存储** | P1 | App端使用SQLite存储，通过Capacitor桥接 |
| **数据导出** | P1 | 支持导出文章为Markdown、JSON格式 |
| **数据导入** | P1 | 支持导入先前导出的数据 |
| **存储统计** | P2 | 显示存储空间使用情况 |

#### 2.1.5 搜索功能
**需求描述**：提供快速的文章搜索能力。

| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **全文搜索** | P0 | 支持标题和内容关键词搜索 |
| **实时搜索** | P0 | 输入时实时显示搜索结果 |
| **搜索结果高亮** | P1 | 搜索结果中高亮显示匹配关键词 |
| **搜索历史** | P2 | 记录搜索历史，支持快速选择 |
| **高级筛选** | P2 | 支持按标签、时间范围等条件筛选 |

### 2.2 平台适配功能

#### 2.2.1 Web/PWA功能
| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **响应式设计** | P0 | 适配桌面、平板、手机屏幕 |
| **PWA支持** | P0 | 可安装到桌面，Service Worker离线支持 |
| **暗色模式** | P1 | 支持深色/浅色主题切换 |
| **快捷键支持** | P2 | 常用操作支持键盘快捷键 |

#### 2.2.2 移动端App功能
| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **Capacitor封装** | P1 | 将Web应用封装为iOS/Android App |
| **原生存储** | P1 | 使用SQLite替代IndexedDB |
| **应用商店上架** | P2 | 符合应用商店审核要求 |
| **推送通知** | P3 | 支持新文章提醒等推送 |

### 2.3 高级功能（v2.0+）

#### 2.3.1 云同步服务（付费功能）
| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **多设备同步** | P2 | 支持Web、App间数据同步 |
| **增量同步** | P2 | 只同步变更数据，节省流量 |
| **冲突解决** | P2 | 时间戳优先的冲突解决策略 |
| **版本历史** | P3 | 保留文章修改历史 |
| **团队协作** | P3 | 支持分享文章给团队成员 |

#### 2.3.2 增强功能
| 功能点 | 优先级 | 验收标准 |
|--------|--------|----------|
| **浏览器扩展** | P2 | 一键剪藏当前浏览的网页 |
| **自动同步** | P2 | 定期检查已剪藏文章的更新 |
| **智能分类** | P3 | AI辅助文章分类和标签建议 |
| **阅读统计** | P3 | 阅读时长、频率等统计报表 |

## 3. 非功能需求

### 3.1 性能需求
| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| **页面加载时间** | < 2秒 (首屏) | Lighthouse测试 |
| **文章剪藏时间** | < 5秒 (平均) | 真实用户监控 |
| **搜索响应时间** | < 200ms | 本地性能测试 |
| **列表滚动性能** | 60 FPS (虚拟列表) | Chrome DevTools |

### 3.2 可用性需求
| 需求 | 标准 |
|------|------|
| **响应式设计** | 支持320px-1920px宽度屏幕 |
| **无障碍访问** | WCAG 2.1 AA标准 |
| **多语言支持** | 中英文界面（预留） |
| **离线可用性** | 核心功能完全离线可用 |

### 3.3 安全需求
| 需求 | 说明 |
|------|------|
| **数据隐私** | 用户数据完全本地存储，不发送到服务器 |
| **网页抓取安全** | 服务端抓取，避免客户端CORS问题 |
| **输入验证** | 严格验证URL和用户输入 |
| **存储加密** | 云同步数据端到端加密（v2.0） |

### 3.4 兼容性需求
| 平台 | 浏览器/版本 | 要求 |
|------|-------------|------|
| **桌面Web** | Chrome 90+, Safari 14+, Firefox 88+ | 完整功能 |
| **移动Web** | iOS Safari 14+, Android Chrome 90+ | 完整功能 |
| **PWA** | 支持PWA的现代浏览器 | 可安装到桌面 |
| **iOS App** | iOS 14+ | 通过App Store审核 |
| **Android App** | Android 8+ | 通过Play Store审核 |

## 4. 用户场景与用户故事

### 4.1 主要用户场景

#### 场景1：快速剪藏技术文章
**用户**：前端开发者小明
**情境**：在浏览技术博客时发现一篇关于React性能优化的文章
**目标**：快速收藏文章，以便日后查阅
**流程**：
1. 复制文章URL
2. 打开归藏应用
3. 粘贴URL到输入框
4. 点击"剪藏"按钮
5. 系统自动抓取、解析、保存
6. 为文章添加"React"、"性能优化"标签
**成功标准**：30秒内完成剪藏，文章内容完整，标签准确

#### 场景2：离线阅读剪藏内容
**用户**：通勤族小红
**情境**：地铁上网络信号差，想阅读之前收藏的文章
**目标**：离线状态下查看文章内容
**流程**：
1. 打开归藏应用（PWA或App）
2. 浏览文章列表（全部内容已缓存）
3. 点击感兴趣的文章
4. 阅读完整内容
5. 添加阅读笔记
**成功标准**：无网络状态下流畅阅读，支持添加笔记

#### 场景3：搜索特定知识点
**用户**：学生小李
**情境**：写论文时需要参考之前收藏的关于"机器学习"的文章
**目标**：快速找到相关文章
**流程**：
1. 打开归藏应用
2. 在搜索框输入"机器学习"
3. 浏览搜索结果
4. 使用标签筛选进一步缩小范围
5. 打开目标文章参考引用
**成功标准**：10秒内找到目标文章，搜索结果准确

### 4.2 用户故事
```yaml
用户故事ID: US-001
标题: 作为用户，我希望通过URL剪藏文章
描述: 我经常在网上看到有用的文章，希望快速保存到本地
验收标准:
  - 输入合法的URL后，系统开始抓取
  - 抓取成功显示文章预览
  - 用户可以编辑标题和内容后保存
  - 保存后文章出现在列表中
优先级: P0

用户故事ID: US-002
标题: 作为用户，我希望离线阅读剪藏的文章
描述: 我在通勤或网络差的环境下想阅读收藏的文章
验收标准:
  - 无网络时可以打开应用
  - 文章列表正常显示
  - 可以打开文章详情查看完整内容
  - 支持基本的搜索功能
优先级: P0

用户故事ID: US-003
标题: 作为用户，我希望为文章添加标签
描述: 我需要整理大量文章，按主题分类管理
验收标准:
  - 可以创建、编辑、删除标签
  - 可以为文章分配多个标签
  - 可以按标签筛选文章列表
  - 标签有颜色区分更直观
优先级: P1
```

## 5. 技术方案概述

### 5.1 整体架构
```
前端层（共享代码）
├── Next.js 15 (App Router) + TypeScript
├── Tailwind CSS + shadcn/ui
├── 响应式设计 + PWA支持
└── Capacitor封装（移动端）

数据层
├── Web端：IndexedDB (Dexie.js)
├── App端：SQLite (Capacitor插件)
└── 统一存储适配层

服务层（后期）
├── 云同步服务（Node.js + PostgreSQL）
├── 用户认证系统（JWT）
└── 支付集成（Stripe/Paddle）
```

### 5.2 核心组件
| 组件 | 技术选型 | 职责 |
|------|----------|------|
| **网页抓取** | jsdom + Readability.js | 抓取和解析网页内容 |
| **格式转换** | turndown | HTML转Markdown |
| **本地存储** | Dexie.js (Web) / SQLite (App) | 文章和标签存储 |
| **全文搜索** | Fuse.js | 客户端全文搜索 |
| **状态管理** | Zustand | 应用状态管理 |
| **数据获取** | TanStack Query | 服务器状态管理 |
| **UI组件** | shadcn/ui + Lucide React | 用户界面组件 |

### 5.3 开发环境
| 工具 | 用途 |
|------|------|
| **Node.js 18+** | 运行时环境 |
| **TypeScript 5+** | 类型安全开发 |
| **npm** | 包管理 |
| **Git** | 版本控制 |
| **VS Code** | 开发IDE |
| **Chrome DevTools** | 调试工具 |

## 6. 商业模式

### 6.1 免费功能（v1.0）
- ✅ 无限文章剪藏
- ✅ 本地存储（IndexedDB/SQLite）
- ✅ 标签管理
- ✅ 全文搜索
- ✅ 数据导入/导出
- ✅ 多平台支持（Web/PWA/App）

### 6.2 付费功能（v2.0 - 云同步服务）
**定价**：$3/月 或 $30/年

| 功能 | 免费版 | 高级版 |
|------|--------|--------|
| **云同步** | ❌ | ✅ 多设备实时同步 |
| **自动备份** | ❌ | ✅ 每日自动备份 |
| **版本历史** | ❌ | ✅ 保留30天修改历史 |
| **团队协作** | ❌ | ✅ 最多3人协作 |
| **API访问** | ❌ | ✅ REST API访问 |
| **优先支持** | ❌ | ✅ 48小时内响应 |

### 6.3 收入预测
| 时期 | 活跃用户 | 付费转化率 | 月收入 |
|------|----------|------------|--------|
| **上线3个月** | 1,000 | 2% | $60 |
| **上线6个月** | 3,000 | 3% | $270 |
| **上线12个月** | 10,000 | 4% | $1,200 |

### 6.4 成本结构
| 成本项 | 月成本 | 说明 |
|--------|--------|------|
| **服务器托管** | $20 | VPS或云服务 |
| **数据库** | $10 | PostgreSQL托管 |
| **CDN/存储** | $5 | 静态资源分发 |
| **支付手续费** | 2.9% + $0.3 | Stripe等支付处理 |
| **总计** | ~$40 | 基础运营成本 |

## 7. 开发路线图

### 7.1 Phase 1: MVP开发 (4周)
**目标**：交付可用的Web PWA版本

| 周次 | 重点任务 | 交付物 |
|------|----------|--------|
| **Week 1** | 基础框架 + 剪藏核心 | 项目脚手架、网页抓取API、基础UI |
| **Week 2** | 管理界面 + 存储层 | 文章列表、详情页、IndexedDB集成 |
| **Week 3** | 搜索功能 + PWA优化 | 全文搜索、Service Worker、响应式优化 |
| **Week 4** | 测试优化 + 发布准备 | 测试覆盖、性能优化、文档完善 |

### 7.2 Phase 2: 移动端扩展 (3周)
**目标**：发布iOS/Android App

| 周次 | 重点任务 | 交付物 |
|------|----------|--------|
| **Week 5** | Capacitor集成 | 移动端项目初始化、原生存储适配 |
| **Week 6** | 平台特定优化 | iOS/Android UI适配、原生功能集成 |
| **Week 7** | 应用商店上架 | 商店材料准备、审核提交、发布 |

### 7.3 Phase 3: 云同步服务 (6周)
**目标**：实现付费云同步功能

| 周次 | 重点任务 | 交付物 |
|------|----------|--------|
| **Week 8-9** | 后端服务开发 | 用户系统、数据同步API、数据库设计 |
| **Week 10-11** | 前端集成 | 同步UI、支付集成、升级引导 |
| **Week 12** | 测试上线 | 端到端测试、灰度发布、监控告警 |

### 7.4 Phase 4: 生态扩展 (持续)
- 浏览器扩展开发
- API开放平台
- 第三方集成
- AI增强功能

## 8. 风险与缓解

### 8.1 技术风险
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| **网页抓取稳定性** | 高 | 多套解析方案备选，支持手动编辑 |
| **IndexedDB存储限制** | 中 | 数据压缩、清理策略、大小监控 |
| **iOS WebView限制** | 中 | Capacitor原生插件补充缺失功能 |
| **同步冲突处理** | 中 | 简单有效的LWW策略，支持手动解决 |

### 8.2 产品风险
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| **用户获取困难** | 高 | 聚焦技术社区、SEO优化、口碑传播 |
| **付费意愿低** | 中 | 提供优秀的免费功能，增值服务明确 |
| **竞品竞争** | 低 | 强调隐私保护和离线优先差异化 |
| **用户数据迁移** | 低 | 提供清晰的导入导出工具 |

### 8.3 商业风险
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| **支付渠道限制** | 中 | 支持多种支付方式（信用卡、PayPal等） |
| **应用商店审核** | 中 | 提前研究审核规则，准备充分材料 |
| **服务器成本增长** | 低 | 按需扩展架构，监控资源使用 |

## 9. 成功度量

### 9.1 产品成功指标
| 指标 | 目标 | 测量频率 |
|------|------|----------|
| **月活跃用户(MAU)** | 3个月: 1,000 | 月度 |
| **用户留存率** | 30日留存 > 25% | 月度 |
| **功能使用率** | 剪藏功能使用率 > 80% | 周度 |
| **用户满意度** | NPS > 30 | 季度 |

### 9.2 技术成功指标
| 指标 | 目标 | 测量频率 |
|------|------|----------|
| **应用性能** | Lighthouse评分 > 90 | 每次发布 |
| **错误率** | 错误率 < 0.1% | 实时 |
| **离线可用性** | 核心功能100%离线可用 | 每次发布 |
| **应用大小** | Web应用 < 2MB (gzip) | 每次发布 |

### 9.3 商业成功指标
| 指标 | 目标 | 测量频率 |
|------|------|----------|
| **付费转化率** | 3个月: 2% | 月度 |
| **月经常性收入(MRR)** | 6个月: $270 | 月度 |
| **用户获取成本(CAC)** | < $5 | 季度 |
| **客户生命周期价值(LTV)** | > $50 | 年度 |

## 10. 附录

### 10.1 术语表
| 术语 | 定义 |
|------|------|
| **剪藏** | 抓取网页文章并保存到本地的过程 |
| **PWA** | 渐进式Web应用，可安装的Web应用 |
| **IndexedDB** | 浏览器本地数据库API |
| **Readability** | Mozilla开发的网页正文提取算法 |
| **LWW** | Last Write Wins，最后写入获胜的冲突解决策略 |

### 10.2 参考文档
1. [架构设计文档](./ARCHITECTURE.md)
2. [API接口文档](./API.md)
3. [项目进度计划](./PROGRESS.md)
4. [任务分解文档](./TASKS.md)

### 10.3 更新记录
| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| 1.0 | 2026-02-16 | 初始版本创建 | [待补充] |

---

**批准签字**：

| 角色 | 姓名 | 签字 | 日期 |
|------|------|------|------|
| 产品负责人 | [待补充] | | |
| 技术负责人 | [待补充] | | |
| 设计负责人 | [待补充] | | |
| 测试负责人 | [待补充] | | |